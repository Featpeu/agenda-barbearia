<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda da Barbearia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: white;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .dia {
      background: #111;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(255,255,255,0.1);
    }
    .hora {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 5px 0;
      padding: 5px 10px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #222;
      flex-wrap: wrap;
    }
    .status {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .disponivel { background: green; }
    .ocupado { background: red; }
    .controle {
      margin-top: 10px;
    }
    .controle input {
      margin-right: 5px;
      padding: 2px;
    }
    .nomeReserva {
      font-size: 0.9em;
      color: #aaa;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>Agenda da Barbearia</h1>

  <div id="agenda"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDnjU_0Rg3eVOzHdK1KEonXnnTd7feSi1c",
      authDomain: "agendabarbearia-b8539.firebaseapp.com",
      projectId: "agendabarbearia-b8539",
      storageBucket: "agendabarbearia-b8539.appspot.com",
      messagingSenderId: "580115238264",
      appId: "1:580115238264:web:c8c66b6b386d0ad03e0c8d",
      measurementId: "G-L7THHNVRK9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const diasSemana = ["Domingo", "Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "Sábado"];
    const horarios = ["09:30", "10:00", "10:30", "11:00", "11:30", "12:00", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00"];

    const agendaContainer = document.getElementById('agenda');
    const hoje = new Date();
    const anoAtual = hoje.getFullYear();
    const mesAtual = hoje.getMonth();

    for (let ano = anoAtual; ano <= anoAtual + 1; ano++) {
      const mesInicio = (ano === anoAtual) ? mesAtual : 0;
      const mesFim = (ano === anoAtual) ? mesAtual + 1 : 11;

      for (let mes = mesInicio; mes <= mesFim; mes++) {
        const dataBase = new Date(ano, mes, 1);
        const tituloMes = document.createElement('h2');
        tituloMes.textContent = `${dataBase.toLocaleString('pt-BR', { month: 'long' })} ${ano}`;
        agendaContainer.appendChild(tituloMes);

        const diasNoMes = new Date(ano, mes + 1, 0).getDate();

        for (let dia = 1; dia <= diasNoMes; dia++) {
          const data = new Date(ano, mes, dia);
          const nomeDia = diasSemana[data.getDay()];
          const divDia = document.createElement('div');
          divDia.className = 'dia';
          const tituloDia = document.createElement('h3');
          tituloDia.textContent = `${nomeDia}, ${dia}/${mes + 1}/${ano}`;
          divDia.appendChild(tituloDia);

          horarios.forEach(hora => {
            const divHora = document.createElement('div');
            divHora.className = 'hora';

            const status = document.createElement('div');
            status.className = 'status disponivel';

            const texto = document.createElement('span');
            texto.textContent = hora;

            const nomeSpan = document.createElement('span');
            nomeSpan.className = 'nomeReserva';

            const controle = document.createElement('div');
            controle.className = 'controle';

            const inputNome = document.createElement('input');
            inputNome.type = 'text';
            inputNome.placeholder = 'Nome';

            const botao = document.createElement('button');
            botao.textContent = 'Reservar';

            const botaoCancelar = document.createElement('button');
            botaoCancelar.textContent = 'Cancelar';
            botaoCancelar.style.marginLeft = '5px';
            botaoCancelar.disabled = true;

            botao.onclick = async () => {
              const nomeDigitado = inputNome.value.trim();
              if (nomeDigitado === '') {
                alert('Digite um nome para reservar ou alterar.');
                return;
              }
              status.classList.remove('disponivel');
              status.classList.add('ocupado');
              nomeSpan.textContent = `Reservado por: ${nomeDigitado}`;
              inputNome.value = '';
              botaoCancelar.disabled = false;

              const chave = `${dia}/${mes + 1}/${ano}-${hora}`;
              await setDoc(doc(db, "agendamentos", chave), { nome: nomeDigitado });
            };

            botaoCancelar.onclick = async () => {
              const confirmar = confirm('Tem certeza que deseja cancelar esta reserva?');
              if (confirmar) {
                status.classList.remove('ocupado');
                status.classList.add('disponivel');
                nomeSpan.textContent = '';
                inputNome.value = '';
                botaoCancelar.disabled = true;

                const chave = `${dia}/${mes + 1}/${ano}-${hora}`;
                await setDoc(doc(db, "agendamentos", chave), { nome: "" });
              }
            };

            controle.appendChild(inputNome);
            controle.appendChild(botao);
            controle.appendChild(botaoCancelar);

            divHora.appendChild(status);
            divHora.appendChild(texto);
            divHora.appendChild(nomeSpan);
            divHora.appendChild(controle);

            divDia.appendChild(divHora);
          });

          agendaContainer.appendChild(divDia);
        }
      }
    }
  </script>
</body>
</html>
